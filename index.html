<style>
    /* 1. Import Fonts - Added 'Pacifico' for the title */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lato:wght@400;700&family=Pacifico&display=swap');

    #doodle-matchmaker-app {
        --primary-color: #8D7B68; --secondary-color: #A4907C; --accent-color: #C8B6A6; --text-color: #3C2A21; --white-color: #FFFFFF; --app-background: #fdfaf6; --font-primary: 'Poppins', sans-serif; --font-secondary: 'Lato', sans-serif;
        /* New font variable for the title */
        --font-title: 'Pacifico', cursive;
        font-family: var(--font-secondary); color: var(--text-color); background-color: var(--white-color); border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        overflow: hidden; width: 100%; max-width: 768px; margin: 1rem auto; box-sizing: border-box;
    }
    #doodle-matchmaker-app *, #doodle-matchmaker-app *::before, #doodle-matchmaker-app *::after { box-sizing: inherit; margin: 0; padding: 0; }
    #doodle-matchmaker-app h1, #doodle-matchmaker-app h2, #doodle-matchmaker-app h3, #doodle-matchmaker-app h4 { font-family: var(--font-primary); font-weight: 700; }
    #doodle-matchmaker-app .doodle-header { padding: 2rem; text-align: center; background-color: var(--secondary-color); color: var(--white-color); }
    
    /* 2. Apply the new font to the H1 title */
    #doodle-matchmaker-app .doodle-header h1 {
        font-family: var(--font-title);
        font-size: 2.75rem; /* Slightly larger for the new font */
        margin-bottom: 0.5rem;
        font-weight: 400; /* Script fonts often look better at a normal weight */
    }

    #doodle-matchmaker-app .doodle-header p { opacity: 0.9; }
    #doodle-matchmaker-app .doodle-main { padding: 1.5rem; }
    #doodle-matchmaker-app .profiles-container { background-color: var(--app-background); padding: 1.5rem; }
    #doodle-matchmaker-app .quiz-container { transition: opacity 0.5s ease-in-out; min-height: 250px; }
    #doodle-matchmaker-app .progress-text { text-align: center; font-size: 0.875rem; color: var(--secondary-color); margin-bottom: 2rem; min-height: 1.2em; }
    #doodle-matchmaker-app .question-area { text-align: center; margin-bottom: 2rem; }
    #doodle-matchmaker-app .question-text { font-size: 1.5rem; color: var(--primary-color); }
    #doodle-matchmaker-app .progress-bar-container { background-color: #E5E7EB; border-radius: 9999px; margin-bottom: 0.5rem; overflow: hidden; }
    #doodle-matchmaker-app .progress-bar { height: 0.625rem; background-color: var(--primary-color); border-radius: 9999px; transition: width 0.5s ease; }
    #doodle-matchmaker-app .answers-area { display: grid; grid-template-columns: 1fr; gap: 1rem; }
    #doodle-matchmaker-app .btn-primary { background-color: var(--primary-color); color: var(--white-color); transition: background-color 0.3s ease; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 700; border: none; cursor: pointer; }
    #doodle-matchmaker-app .btn-primary:hover { background-color: var(--text-color); }
    #doodle-matchmaker-app .answer-btn { background-color: var(--white-color); color: var(--primary-color); border: 2px solid var(--accent-color); transition: all 0.3s ease; padding: 1rem; border-radius: 0.5rem; font-family: var(--font-primary); font-weight: 600; cursor: pointer; text-align: center; }
    #doodle-matchmaker-app .answer-btn:hover { background-color: var(--primary-color); color: var(--white-color); border-color: var(--primary-color); transform: translateY(-3px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    #doodle-matchmaker-app .results-container { text-align: center; }
    #doodle-matchmaker-app .results-container h2 { font-size: 1.875rem; color: var(--primary-color); margin-bottom: 1.5rem; }
    #doodle-matchmaker-app .results-disclaimer { font-size: 0.875rem; color: #555; margin-bottom: 1.5rem; }
    #doodle-matchmaker-app .top-matches { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem; }
    #doodle-matchmaker-app .match-card { background-color: var(--app-background); border: 1px solid var(--accent-color); border-radius: 0.5rem; padding: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease; width: 100%; max-width: 208px; }
    #doodle-matchmaker-app .match-card:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
    #doodle-matchmaker-app .primary-match { border: 3px solid var(--primary-color); transform: scale(1.05); }
    #doodle-matchmaker-app .match-card img { width: 100%; height: 9rem; object-fit: cover; border-radius: 0.375rem; margin-bottom: 1rem; }
    #doodle-matchmaker-app .match-card h3 { font-size: 1.25rem; color: var(--primary-color); margin-bottom: 0.25rem; }
    #doodle-matchmaker-app .match-card p { font-size: 1.125rem; font-weight: 600; color: var(--secondary-color); font-family: var(--font-primary); }
    #doodle-matchmaker-app .profile-card { padding: 1.5rem; background-color: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    #doodle-matchmaker-app .profile-content { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    #doodle-matchmaker-app .profile-card img { width: 100%; height: auto; object-fit: cover; border-radius: 0.5rem; margin-bottom: 1rem; }
    #doodle-matchmaker-app .profile-card h3 { font-size: 1.5rem; color: var(--primary-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 0.5rem; margin-bottom: 1rem; }
    #doodle-matchmaker-app .profile-card h4 { font-size: 1.125rem; color: var(--secondary-color); margin-bottom: 0.5rem; }
    #doodle-matchmaker-app .profile-card p { line-height: 1.6; font-size: 0.875rem; margin-bottom: 1rem; color: var(--text-color); }
    #doodle-matchmaker-app .doodle-footer { background-color: #3C2A21; padding: 1.5rem; text-align: center; color: var(--white-color); }
    #doodle-matchmaker-app .doodle-footer p { font-size: 0.875rem; }
    #doodle-matchmaker-app .footer-disclaimer { font-size: 0.75rem; font-style: italic; opacity: 0.8; margin-top: 1rem; }
    #doodle-matchmaker-app .error-message { color: #b91c1c; background-color: #fee2e2; padding: 1rem; border-radius: 0.5rem; margin: 1rem; text-align: center; }
    #doodle-matchmaker-app .hidden { display: none !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    #doodle-matchmaker-app .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @media (min-width: 768px) {
        #doodle-matchmaker-app .doodle-header h1 { font-size: 3.25rem; } /* Adjusted size for desktop */
        #doodle-matchmaker-app .answers-area { grid-template-columns: repeat(2, 1fr); }
        #doodle-matchmaker-app .top-matches { flex-direction: row; align-items: flex-start; }
        #doodle-matchmaker-app .profile-content { grid-template-columns: repeat(2, 1fr); }
    }
</style>
<div id="doodle-matchmaker-app">
    <header class="doodle-header">
        <h1>The Doodle Matchmaker</h1>
        <p>Answer a few questions to find your perfect Doodle companion!</p>
    </header>
    <div class="error-container hidden">
        <div class="error-message">
            <strong>Error Initializing Quiz.</strong>
            <p class="error-details"></p>
        </div>
    </div>
    <main class="doodle-main">
        <div class="quiz-container">
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: 0%"></div>
            </div>
            <p class="progress-text">Loading...</p>
            <div class="question-area">
                <h2 class="question-text"></h2>
            </div>
            <div class="answers-area"></div>
        </div>
        <div class="results-container hidden">
            <h2>Your Top Doodle Matches!</h2>
            <div class="top-matches"></div>
            <p class="results-disclaimer">Click a breed to learn more. Remember, this is a guide! We recommend further research and meeting breeds in person.</p>
            <button class="retake-quiz-btn btn-primary">Retake Quiz</button>
        </div>
    </main>
    <section class="profiles-container"></section>
    <footer class="doodle-footer">
        <p>&copy; 2024 TruReveal Digital. All Rights Reserved.</p>
        <p class="footer-disclaimer">This tool is for informational purposes only. Choosing a dog is a major life decision. Please consult with veterinarians, reputable breeders, and rescue organizations.</p>
    </footer>
</div>
<script>
    function initializeDoodleMatchmaker(appContainer) {
        setTimeout(function() {
            if (!appContainer || appContainer.getAttribute('data-initialized') === 'true') {
                return;
            }
            appContainer.setAttribute('data-initialized', 'true');

            function displayError(error, container) {
                console.error("Doodle Matchmaker CRITICAL ERROR:", error);
                var errorContainer = container.querySelector('.error-container');
                var errorDetails = container.querySelector('.error-details');
                var mainContent = container.querySelector('.doodle-main');
                if (errorContainer && errorDetails) {
                    errorDetails.textContent = error.message || "An unknown error occurred.";
                    errorContainer.classList.remove('hidden');
                    if (mainContent) mainContent.classList.add('hidden');
                }
            }

            try {
                // 4. Added Cavalabradoodle to the data
                var doodleData = {
                    "maltipoo":{"name":"Maltipoo","size":1,"energy":3,"grooming":4,"kidFriendly":4,"petFriendly":5,"apartmentFit":5,"barking":3,"aloneToler":2,"image":"https://placehold.co/400x300/A4907C/FFFFFF?text=Maltipoo","profile":{"glance":"<strong>Parent Breeds:</strong> Maltese & Poodle<br><strong>Weight:</strong> 5-20 pounds<br><strong>Lifespan:</strong> 10-16 years<br><strong>Temperament:</strong> Friendly, Gentle, Outgoing, Playful, Affectionate","temperament":"Maltipoos are charming, playful, and affectionate dogs that pack a big personality into a small body. A cross between a Maltese and a Toy or Miniature Poodle, they are known for their gentle and loving nature. They are highly social, adapt well to new environments, and make friends with just about everyone they meet. They are intelligent and eager to be with their people, making them delightful and entertaining companions.","household":"Maltipoos are generally good with children due to their gentle and playful nature. However, because of their very small and delicate size, interactions with toddlers and young children must be carefully supervised to prevent accidental injury to the dog. They are often better suited for homes with older, respectful children. They are sociable and typically get along very well with other dogs and cats.","challenges":"Maltipoos are true companion dogs and cannot be left alone for long periods; they are highly prone to separation anxiety. They can be vocal and may develop a habit of barking at suspicious noises or to get attention if not properly trained and stimulated."}},
                    "cavapoo":{"name":"Cavapoo","size":2,"energy":3,"grooming":4,"kidFriendly":5,"petFriendly":5,"apartmentFit":4,"barking":2,"aloneToler":2,"image":"https://placehold.co/400x300/8D7B68/FFFFFF?text=Cavapoo","profile":{"glance":"<strong>Parent Breeds:</strong> Cavalier King Charles Spaniel & Poodle<br><strong>Weight:</strong> 8-25 pounds<br><strong>Lifespan:</strong> 12-15 years<br><strong>Temperament:</strong> Friendly, Gentle, Playful, Loving, Intelligent","temperament":"The Cavapoo is a gentle, affectionate, and sweet-natured dog, inheriting the loving companion traits of the Cavalier King Charles Spaniel and the intelligence of the Poodle. They are known for being incredibly friendly and sociable, enjoying the company of people of all ages. They are eager to please and highly trainable, responding well to positive reinforcement. Cavapoos thrive in family environments and crave attention, making them wonderful lapdogs.","household":"Their gentle and friendly temperament makes them excellent pets for families with children. They are playful but not overly boisterous, making them suitable even for households with younger kids, though supervision is always wise. Cavapoos are typically a great match for other pets, including cats and other dogs.","challenges":"Like many companion breeds, Cavapoos are highly prone to separation anxiety. They struggle when left alone for long periods and may develop behaviors like excessive barking or destructiveness. Some can be sensitive to loud noises."}},
                    "cavalabradoodle":{"name":"Cavalabradoodle","size":3,"energy":4,"grooming":4,"kidFriendly":5,"petFriendly":5,"apartmentFit":3,"barking":3,"aloneToler":3,"image":"https://placehold.co/400x300/A4907C/FFFFFF?text=Cavalabradoodle","profile":{"glance":"<strong>Parent Breeds:</strong> Cavalier, Labrador & Poodle<br><strong>Weight:</strong> 25-50 pounds<br><strong>Lifespan:</strong> 11-15 years<br><strong>Temperament:</strong> Extremely Friendly, Loyal, Trainable, Gentle","temperament":"The Cavalabradoodle is a triple-cross that aims to combine the gentle nature of the Cavalier King Charles Spaniel with the classic friendliness of a Labrador and the intelligence of a Poodle. The result is a highly sociable, good-natured, and devoted family dog that rarely meets a stranger.","household":"This breed is an excellent choice for families. Their inherent gentleness and patience make them fantastic with children of all ages, and their sociable nature means they typically get along wonderfully with other dogs and household pets.","challenges":"Their high social needs mean they can be prone to separation anxiety if left alone too often. Their combination of intelligent and energetic parents requires consistent training and daily exercise to prevent boredom and ensure a well-behaved companion."}},
                    "cockapoo":{"name":"Cockapoo","size":2,"energy":4,"grooming":4,"kidFriendly":5,"petFriendly":5,"apartmentFit":4,"barking":3,"aloneToler":2,"image":"https://placehold.co/400x300/C8B6A6/3C2A21?text=Cockapoo","profile":{"glance":"<strong>Parent Breeds:</strong> Cocker Spaniel & Poodle<br><strong>Weight:</strong> 12-24 pounds (Miniature)<br><strong>Lifespan:</strong> 12-15 years<br><strong>Temperament:</strong> Social, Intelligent, Friendly, Trainable, Affectionate","temperament":"Cockapoos are one of the oldest and most beloved doodle mixes, known for their incredibly friendly and sociable nature. They blend the Cocker Spaniel's affectionate personality with the Poodle's intelligence, resulting in a dog that is both a loving companion and an eager learner. They thrive on human interaction and are often described as \"velcro dogs\" who love to be close to their people.","household":"Cockapoos are excellent family dogs and are known for being gentle and patient with children. Their playful nature and manageable size make them wonderful companions for kids. They are highly social and generally get along very well with other dogs and cats.","challenges":"Their deep need for companionship makes them highly susceptible to separation anxiety if left alone for long periods. This can lead to common anxiety behaviors like excessive barking and chewing. They can be vocal if their social or exercise needs are not being met."}},
                    "aussiedoodle":{"name":"Aussiedoodle","size":4,"energy":5,"grooming":5,"kidFriendly":3,"petFriendly":4,"apartmentFit":2,"barking":4,"aloneToler":2,"image":"https://placehold.co/400x300/A4907C/FFFFFF?text=Aussiedoodle","profile":{"glance":"<strong>Parent Breeds:</strong> Australian Shepherd & Poodle<br><strong>Weight:</strong> 40-75 pounds (Standard)<br><strong>Lifespan:</strong> 10-13 years<br><strong>Temperament:</strong> Intelligent, Energetic, Loyal, Playful, Eager-to-Please","temperament":"The Aussiedoodle is a crossbreed of two of the most intelligent dog breeds, often called the \"Einstein\" of the doodle world. They are intensely loyal, eager to please, and highly trainable, quickly picking up commands and complex tricks. They are highly social dogs that form strong bonds with their families and thrive on being included in all activities.","household":"Aussiedoodles can be great with children, as they are playful and patient. However, their high energy and potential herding instinct (nipping at heels) mean that interactions with young children must be closely supervised. They are often better suited for families with older, active children. They are generally friendly with other pets when socialized early.","challenges":"Their high intelligence and energy mean they can become bored and destructive if not adequately stimulated. They are prone to separation anxiety due to their deep attachment to their owners. They can also be vocal, barking to alert their owners or out of boredom."}},
                    "labradoodle":{"name":"Labradoodle","size":4,"energy":5,"grooming":4,"kidFriendly":5,"petFriendly":5,"apartmentFit":2,"barking":3,"aloneToler":3,"image":"https://placehold.co/400x300/8D7B68/FFFFFF?text=Labradoodle","profile":{"glance":"<strong>Parent Breeds:</strong> Labrador Retriever & Poodle<br><strong>Weight:</strong> 50-65 pounds (Standard)<br><strong>Lifespan:</strong> 12-16 years<br><strong>Temperament:</strong> Friendly, Intelligent, Loyal, Energetic, Playful","temperament":"As the original doodle hybrid, the Labradoodle set the standard for what a Poodle cross could be: intelligent, loyal, and family-oriented. They inherit the quintessential friendliness and high energy of the Labrador Retriever, making them happy-go-lucky companions who are eager to please. Their intelligence makes them highly trainable and excellent candidates for therapy and service work.","household":"Labradoodles are generally excellent with children due to their gentle, patient, and playful nature. With proper introductions, Labradoodles typically get along very well with other dogs and can even coexist peacefully with cats.","challenges":"Labradoodles are highly social and can be prone to separation anxiety if left alone for extended periods, which can manifest as excessive barking or destructive behavior. They can also be vocal, using their bark to express excitement or alert their family to strangers."}},
                    "goldendoodle":{"name":"Goldendoodle","size":4,"energy":4,"grooming":4,"kidFriendly":5,"petFriendly":5,"apartmentFit":2,"barking":2,"aloneToler":3,"image":"https://placehold.co/400x300/C8B6A6/3C2A21?text=Goldendoodle","profile":{"glance":"<strong>Parent Breeds:</strong> Golden Retriever & Poodle<br><strong>Weight:</strong> 50-80 pounds (Standard)<br><strong>Lifespan:</strong> 10-15 years<br><strong>Temperament:</strong> Playful, Loyal, Affectionate, Gentle, Intelligent","temperament":"Goldendoodles are the quintessential family dog, blending the Golden Retriever's renowned friendly and patient nature with the Poodle's intelligence and loyalty. They are known for their gentle temperament, making them exceptionally well-suited for families with children. These dogs are highly social, adaptable, and eager to please, which makes them relatively easy to train.","household":"Goldendoodles are famously good with children. Their gentle and loving nature makes them fantastic companions for kids of all ages. Their amicable demeanor makes them highly compatible with other dogs and cats.","challenges":"Being highly people-oriented, Goldendoodles are prone to separation anxiety if left alone for too long, which can lead to excessive barking or destructive behaviors. They will use their voice to alert their family to visitors or unusual sounds."}},
                    "sheepadoodle":{"name":"Sheepadoodle","size":5,"energy":4,"grooming":5,"kidFriendly":4,"petFriendly":4,"apartmentFit":1,"barking":4,"aloneToler":1,"image":"https://placehold.co/400x300/A4907C/FFFFFF?text=Sheepadoodle","profile":{"glance":"<strong>Parent Breeds:</strong> Old English Sheepdog & Poodle<br><strong>Weight:</strong> 60-85 pounds (Standard)<br><strong>Lifespan:</strong> 12-15 years<br><strong>Temperament:</strong> Gentle, Playful, Intelligent, Affectionate, Loyal","temperament":"Sheepadoodles are large, lovable dogs with a happy-go-lucky and gentle nature. They inherit the intelligence of the Poodle and the affectionate, clownish personality of the Old English Sheepdog. They are known to be excellent family companions who are playful, sweet, and thrive on attention.","household":"Sheepadoodles are generally wonderful with children, being patient and playful. However, their large size and herding instinct can be a challenge with very young children, as they may try to 'herd' them. They are often recommended for families with older children. They typically get along well with other pets.","challenges":"Sheepadoodles are highly prone to separation anxiety and do not do well when left alone for long periods. Their herding instinct and a puppy phase known as the \"Sharkadoodle\" (mouthing and nipping) require consistent, patient training. Their coat is extremely high-maintenance."}},
                    "bernedoodle":{"name":"Bernedoodle","size":5,"energy":3,"grooming":5,"kidFriendly":5,"petFriendly":4,"apartmentFit":1,"barking":2,"aloneToler":2,"image":"https://placehold.co/400x300/8D7B68/FFFFFF?text=Bernedoodle","profile":{"glance":"<strong>Parent Breeds:</strong> Bernese Mountain Dog & Poodle<br><strong>Weight:</strong> 70-90+ pounds (Standard)<br><strong>Lifespan:</strong> 12-15 years<br><strong>Temperament:</strong> Gentle, Loyal, Playful, Calm, Goofy","temperament":"The Bernedoodle combines the calm, loyal, and famously gentle nature of the Bernese Mountain Dog with the intelligence and playfulness of the Poodle. This mix results in a dog that is often described as easy-going, patient, and affectionateâ€”a true \"gentle giant.\" They can inherit a stubborn streak, which usually fades with consistent training.","household":"Bernedoodles are spectacular with children. Their natural patience, gentleness, and tolerance make them one of the best doodle choices for families with kids of all ages, including toddlers. They generally have a low prey drive and coexist peacefully with other pets.","challenges":"Like other doodles, their strong bond with their family makes them prone to separation anxiety if left alone for long periods. Their large size means they must be taught gentleness with small children and pets. Their thick, curly coat is high-maintenance."}}};
                var questions = [{"question":"What is your living situation?","trait":"apartmentFit","weight":2,"answers":[{"text":"Apartment/Condo (no yard)","score":5},{"text":"House with a small yard","score":3},{"text":"House with a large yard","score":1}]},{"question":"How would you describe your daily activity level?","trait":"energy","weight":1.5,"answers":[{"text":"Mostly relaxed, short walks","score":2},{"text":"Moderately active, daily walks & play","score":3},{"text":"Very active, love long runs/hikes","score":5}]},{"question":"How much time can you commit to grooming each week?","trait":"grooming","weight":1,"answers":[{"text":"Minimal time, a quick brush here and there","score":2},{"text":"A few sessions a week (1-2 hours total)","score":4},{"text":"I'm ready for daily brushing!","score":5}]},{"question":"Will the dog be around young children (under 10)?","trait":"kidFriendly","weight":1.5,"answers":[{"text":"Yes, often","score":5},{"text":"Sometimes","score":4},{"text":"No, it will be an adult-only home","score":3}]},{"question":"Do you have other pets (cats or dogs)?","trait":"petFriendly","weight":1.5,"answers":[{"text":"Yes, I have other pets","score":5},{"text":"No, this will be the only pet","score":3}]},{"question":"On a typical day, how many hours will the dog be left alone?","trait":"aloneToler","weight":2,"answers":[{"text":"0-4 hours (someone is almost always home)","score":5},{"text":"4-6 hours","score":3},{"text":"6+ hours","score":1}]},{"question":"How do you feel about a dog that barks?","trait":"barking","weight":0.8,"answers":[{"text":"I prefer a very quiet dog","score":1},{"text":"Some barking is okay","score":3},{"text":"I don't mind a vocal dog","score":5}]},{"question":"What size of dog are you most comfortable with?","trait":"size","weight":1.2,"answers":[{"text":"Small (under 25 lbs)","score":1},{"text":"Medium (25-50 lbs)","score":3},{"text":"Large (50+ lbs)","score":5}]}];
                var currentQuestionIndex = 0;
                var userScores = {};
                var quizContainer = appContainer.querySelector('.quiz-container');
                var resultsContainer = appContainer.querySelector('.results-container');
                var progressBar = appContainer.querySelector('.progress-bar');
                var progressText = appContainer.querySelector('.progress-text');
                var questionText = appContainer.querySelector('.question-text');
                var answersArea = appContainer.querySelector('.answers-area');
                var topMatchesContainer = appContainer.querySelector('.top-matches');
                var retakeQuizBtn = appContainer.querySelector('.retake-quiz-btn');
                var profilesContainer = appContainer.querySelector('.profiles-container');

                function createAndAppend(tag, parent, options) {
                    var el = document.createElement(tag);
                    if (options) {
                        if (options.className) el.className = options.className;
                        if (options.textContent) el.textContent = options.textContent;
                        if (options.innerHTML) el.innerHTML = options.innerHTML;
                        if (options.src) el.src = options.src;
                        if (options.alt) el.alt = options.alt;
                        if (options.dataset) { Object.keys(options.dataset).forEach(function(key) { el.setAttribute('data-' + key, options.dataset[key]); }); }
                    }
                    parent.appendChild(el);
                    return el;
                }

                function showQuestionContent() {
                    var currentQuestion = questions[currentQuestionIndex];
                    if (!currentQuestion) return;
                    questionText.textContent = currentQuestion.question;
                    answersArea.innerHTML = '';
                    currentQuestion.answers.forEach(function(answer) {
                        var button = createAndAppend('button', answersArea, { className: 'answer-btn', textContent: answer.text });
                        button.addEventListener('click', function() { selectAnswer(currentQuestion.trait, answer.score); });
                    });
                    updateProgressBar();
                    quizContainer.style.opacity = 1;
                }

                function updateProgressBar() {
                    var progress = (currentQuestionIndex / questions.length) * 100;
                    progressBar.style.width = progress + '%';
                    if (currentQuestionIndex < questions.length) { progressText.textContent = 'Question ' + (currentQuestionIndex + 1) + ' / ' + questions.length; }
                }

                function selectAnswer(trait, score) {
                    userScores[trait] = score;
                    currentQuestionIndex++;
                    if (currentQuestionIndex < questions.length) {
                        quizContainer.style.opacity = 0;
                        setTimeout(showQuestionContent, 300);
                    } else {
                        progressBar.style.width = '100%';
                        progressText.textContent = 'Calculating your results...';
                        setTimeout(calculateResults, 500);
                    }
                }

                function calculateResults() {
                    var results = [];
                    Object.keys(doodleData).forEach(function(breedKey) {
                        var breed = doodleData[breedKey];
                        var totalDifference = 0;
                        questions.forEach(function(question) { totalDifference += Math.abs(userScores[question.trait] - breed[question.trait]) * question.weight; });
                        results.push({ breedKey: breedKey, name: breed.name, score: totalDifference, image: breed.image });
                    });
                    results.sort(function(a, b) { return a.score - b.score; });
                    displayResults(results);
                }

                function displayResults(sortedResults) {
                    quizContainer.classList.add('hidden');
                    resultsContainer.classList.remove('hidden');
                    resultsContainer.classList.add('fade-in');
                    topMatchesContainer.innerHTML = '';
                    var top3 = sortedResults.slice(0, 3);
                    var maxPossibleDifference = 0;
                    questions.forEach(function(q) { maxPossibleDifference += 4 * q.weight; });
                    top3.forEach(function(result, index) {
                        var compatibilityPercent = Math.max(0, Math.round((1 - (result.score / maxPossibleDifference)) * 100));
                        var matchCard = createAndAppend('div', topMatchesContainer, { className: 'match-card ' + (index === 0 ? 'primary-match' : ''), dataset: { breed: result.breedKey } });
                        var img = createAndAppend('img', matchCard, { src: result.image, alt: 'A cute ' + result.name });
                        img.onerror = function() { this.onerror = null; this.src = 'https://placehold.co/400x300/cccccc/ffffff?text=Image+Not+Found'; };
                        createAndAppend('h3', matchCard, { textContent: (index + 1) + '. ' + result.name });
                        createAndAppend('p', matchCard, { textContent: compatibilityPercent + '% Match' });
                        matchCard.addEventListener('click', function() { showProfile(result.breedKey); });
                    });
                    setTimeout(function() { if (typeof resultsContainer.scrollIntoView === 'function') { resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); } }, 100);
                }

                function showProfile(breedKey) {
                    var profileCards = appContainer.querySelectorAll('.profile-card');
                    for (var i = 0; i < profileCards.length; i++) { profileCards[i].classList.add('hidden'); profileCards[i].classList.remove('fade-in'); }
                    var profileToShow = appContainer.querySelector('.profile-card[data-breed="' + breedKey + '"]');
                    if (profileToShow) {
                        profileToShow.classList.remove('hidden');
                        void profileToShow.offsetWidth;
                        profileToShow.classList.add('fade-in');
                        if (typeof profileToShow.scrollIntoView === 'function') { profileToShow.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
                    }
                }

                function populateProfiles() {
                    profilesContainer.innerHTML = '';
                    Object.keys(doodleData).forEach(function(breedKey) {
                        var breed = doodleData[breedKey];
                        var profileDiv = createAndAppend('div', profilesContainer, { className: 'profile-card hidden', dataset: { breed: breedKey } });
                        createAndAppend('h3', profileDiv, { textContent: 'The ' + breed.name });
                        var content = createAndAppend('div', profileDiv, { className: 'profile-content' });
                        var col1 = createAndAppend('div', content);
                        var img = createAndAppend('img', col1, { src: breed.image, alt: 'A cute ' + breed.name });
                        img.onerror = function() { this.onerror = null; this.src = 'https://placehold.co/400x300/cccccc/ffffff?text=Image+Not+Found'; };
                        createAndAppend('h4', col1, { textContent: 'At a Glance' });
                        createAndAppend('p', col1, { innerHTML: breed.profile.glance });
                        var col2 = createAndAppend('div', content);
                        createAndAppend('h4', col2, { textContent: 'Temperament & Personality' });
                        createAndAppend('p', col2, { textContent: breed.profile.temperament });
                        createAndAppend('h4', col2, { textContent: 'Household Compatibility' });
                        createAndAppend('p', col2, { textContent: breed.profile.household });
                        createAndAppend('h4', col2, { textContent: 'Potential Challenges' });
                        createAndAppend('p', col2, { textContent: breed.profile.challenges });
                    });
                }

                function resetQuiz() {
                    currentQuestionIndex = 0; userScores = {};
                    resultsContainer.classList.add('hidden');
                    quizContainer.classList.remove('hidden');
                    var profileCards = appContainer.querySelectorAll('.profile-card');
                    for (var i = 0; i < profileCards.length; i++) { profileCards[i].classList.add('hidden'); }
                    showQuestionContent();
                    if (typeof appContainer.scrollIntoView === 'function') { appContainer.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
                }

                retakeQuizBtn.addEventListener('click', resetQuiz);
                populateProfiles();
                showQuestionContent();

            } catch (error) {
                displayError(error, appContainer);
            }
        }, 50); 
    }

    var initializationAttempts = 0;
    var initializationInterval = setInterval(function() {
        initializationAttempts++;
        var appContainer = document.getElementById('doodle-matchmaker-app');
        
        if (appContainer && appContainer.offsetWidth > 0) {
            clearInterval(initializationInterval);
            initializeDoodleMatchmaker(appContainer);
        } else if (initializationAttempts > 30) {
            clearInterval(initializationInterval);
            console.error("Doodle Matchmaker: Timed out waiting for container to become visible.");
            if (appContainer) {
                var progressText = appContainer.querySelector('.progress-text');
                if (progressText) { progressText.textContent = "Error: App failed to load."; }
            }
        }
    }, 200);
</script>
